<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分组管理表格</title>
    <link rel="stylesheet" href="styles.css">
    <!-- 加载Buffer库 -->
    <script src="https://cdn.jsdelivr.net/npm/buffer@6.0.3/index.js"></script>
    <!-- 直接从官方CDN加载WebTorrent -->
    <script src="https://cdn.jsdelivr.net/npm/webtorrent@1.8.1/webtorrent.min.js"></script>
    <!-- 兼容性修复 -->
    <script>
        // 确保WebTorrent正确加载
        window.addEventListener('DOMContentLoaded', function() {
            if (typeof WebTorrent === 'undefined') {
                console.error('WebTorrent库加载失败，尝试备用加载');
                var script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/webtorrent/1.8.1/webtorrent.min.js';
                script.onload = function() {
                    console.log('WebTorrent库备用加载成功');
                    if (typeof initApp === 'function') initApp();
                };
                script.onerror = function() {
                    console.error('WebTorrent备用库也加载失败');
                    alert('网络连接组件加载失败，请刷新页面或检查网络连接');
                };
                document.head.appendChild(script);
            } else {
                console.log('WebTorrent库加载成功');
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>中国近现代史纲要分组</h1>
            <!-- P2P连接状态显示 -->
            <div class="connection-info">
                <div id="connection-status">正在连接网络...</div>
                <div id="room-info" style="display:none;">
                    <input type="text" id="room-id" value="default-room">
                </div>
            </div>
        </header>

        <main>
            <div class="table-controls">
                <div class="left-controls">
                    <button id="add-group" class="primary-btn">添加新分组</button>
                    <button id="export-data" class="export-btn">导出分组信息</button>
                </div>
                <div class="right-controls">
                    <button id="save-local" class="save-btn">保存分组信息</button>
                    <button id="load-local" class="primary-btn">加载保存的信息</button>
                </div>
            </div>

            <div class="table-container">
                <table id="group-table">
                    <thead>
                        <tr>
                            <th>组名</th>
                            <th>成员</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- 表格内容将通过JS动态生成 -->
                    </tbody>
                </table>
            </div>

            <!-- 未分组成员区域 -->
            <div class="ungrouped-section">
                <h2>公开求组区</h2>
                <div class="ungrouped-controls">
                    <input type="text" id="new-member-name" placeholder="输入姓名">
                    <button id="add-ungrouped" class="add-btn">添加</button>
                </div>
                <div id="ungrouped-list" class="ungrouped-list">
                    <!-- 未分组成员将在此动态生成 -->
                </div>
            </div>

            <div id="connected-peers">
                <h3>已连接用户</h3>
                <div id="peer-list" class="peer-list">
                    <!-- 连接的用户将在此显示 -->
                </div>
            </div>
        </main>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>
    <script src="app.js"></script>
</body>
</html> 